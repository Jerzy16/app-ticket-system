<header class="flex h-14 items-center justify-between px-4 border-b border-gray-500">
    <div class="flex gap-4 items-center">
        <app-logo />
        <fa-icon [icon]="getIcon('search')"
            class="text-gray-600 ml-4 cursor-pointer hover:text-secondary transition-colors" (click)="openSearch()" />
    </div>

    <div class="flex">
        <button class="py-2 cursor-pointer text-sm px-4 rounded-l-lg transition-colors"
            [class.bg-secondary]="isActive('/kanban')" [class.text-white]="isActive('/kanban')"
            [class.bg-gray-200]="!isActive('/kanban')" [class.text-gray-600]="!isActive('/kanban')"
            (click)="navigate('/kanban')">
            <fa-icon [icon]="getIcon('check')" />
            Tareas
        </button>
        <button class="py-2 cursor-pointer text-sm px-4 border-l border-gray-300 transition-colors"
            [class.bg-secondary]="isActive('/kanban/staff')" [class.text-white]="isActive('/kanban/staff')"
            [class.bg-gray-200]="!isActive('/kanban/staff')" [class.text-gray-600]="!isActive('/kanban/staff')"
            (click)="navigate('/kanban/staff')">
            <fa-icon [icon]="getIcon('users-gear')" />
            Personal
        </button>
        <button class="py-2 text-sm px-4 bg-gray-200 border-l border-gray-300 hover:bg-gray-300 transition-colors">
            <fa-icon [icon]="getIcon('hammer')" class="text-gray-600" />
            Herramientas
        </button>
        <button
            class="py-2 text-sm px-4 bg-gray-200 rounded-r-lg border-l border-gray-300 hover:bg-gray-300 transition-colors">
            <fa-icon [icon]="getIcon('chart-line')" class="text-gray-600" />
            Reportes
        </button>
    </div>

    <div class="flex items-center gap-4">
        <!-- NOTIFICACIONES -->
        <div class="relative notifications-container">
            <button (click)="toggleNotifications()"
                class="relative hover:text-secondary transition-colors focus:outline-none">
                <fa-icon [icon]="getIcon('bell')" class="text-gray-600 text-lg" />
                @if (unreadCount > 0) {
                    <span
                        class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-4 w-4 flex items-center justify-center">
                        {{ unreadCount > 9 ? '9+' : unreadCount }}
                    </span>
                }
            </button>

            <!-- Panel de Notificaciones -->
            @if (showNotifications) {
                <div class="absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-lg border border-gray-200 z-50 animate-fadeIn max-h-[32rem] flex flex-col">
                    <!-- Header del panel -->
                    <div class="px-4 py-3 border-b border-gray-200 flex items-center justify-between">
                        <h3 class="text-sm font-semibold text-gray-800">
                            Notificaciones
                        </h3>
                        @if (unreadCount > 0) {
                            <button (click)="markAllAsRead($event)"
                                class="text-xs text-blue-600 hover:text-blue-800 font-medium">
                                Marcar todas como leídas
                            </button>
                        }
                    </div>

                    <!-- Lista de notificaciones -->
                    <div class="overflow-y-auto flex-1">
                        @if (notifications.length === 0) {
                            <div class="px-4 py-8 text-center text-gray-500">
                                <fa-icon [icon]="getIcon('bell-slash')" class="text-3xl mb-2 text-gray-400" />
                                <p class="text-sm">No tienes notificaciones</p>
                            </div>
                        } @else {
                            @for (notification of notifications; track notification.id) {
                                <div (click)="goToTask(notification)"
                                    [class.bg-blue-50]="!notification.read"
                                    [class.bg-white]="notification.read"
                                    class="px-4 py-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors">
                                    <div class="flex items-start gap-3">
                                        <div [class.text-blue-500]="!notification.read"
                                            [class.text-gray-400]="notification.read"
                                            class="flex-shrink-0 mt-1">
                                            <fa-icon [icon]="getIcon(getNotificationIcon(notification.type))"
                                                class="text-lg" />
                                        </div>
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-start justify-between gap-2">
                                                <p [class.font-semibold]="!notification.read"
                                                    [class.text-gray-900]="!notification.read"
                                                    [class.text-gray-700]="notification.read"
                                                    class="text-sm">
                                                    {{ notification.title }}
                                                </p>
                                                @if (!notification.read) {
                                                    <button (click)="markAsRead(notification, $event)"
                                                        class="flex-shrink-0 text-blue-600 hover:text-blue-800"
                                                        title="Marcar como leída">
                                                        <fa-icon [icon]="getIcon('check')" class="text-xs" />
                                                    </button>
                                                }
                                            </div>

                                            <p class="text-xs text-gray-600 mt-1 line-clamp-2">
                                                {{ notification.message }}
                                            </p>

                                            <div class="flex items-center gap-2 mt-2">
                                                <span class="text-xs text-gray-500">
                                                    {{ formatDate(notification.createdAt) }}
                                                </span>
                                                @if (notification.taskTitle) {
                                                    <span class="text-xs text-gray-400">•</span>
                                                    <span class="text-xs text-gray-500 truncate">
                                                        {{ notification.taskTitle }}
                                                    </span>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                    @if (notifications.length > 0) {
                        <div class="px-4 py-2 border-t border-gray-200 text-center">
                            <button (click)="navigate('/notifications')"
                                class="text-xs text-blue-600 hover:text-blue-800 font-medium">
                                Ver todas las notificaciones
                            </button>
                        </div>
                    }
                </div>
            }
        </div>
        <div class="relative dropdown-container">
            <button (click)="toggleDropdown()"
                class="flex items-center gap-2 hover:opacity-80 transition-opacity focus:outline-none">
                <img [src]="currentUser?.photo || '/assets/img/perfil.webp'" alt="Perfil"
                    class="h-8 w-8 object-cover rounded-full border-2 border-gray-300" />
                <fa-icon [icon]="getIcon('chevron-down')" class="text-gray-600 text-sm transition-transform"
                    [class.rotate-180]="showDropdown" />
            </button>
            @if (showDropdown) {
                <div class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50 animate-fadeIn">
                    <div class="px-4 py-3 border-b border-gray-200">
                        <p class="text-sm font-semibold text-gray-800">
                            {{ currentUser?.name || 'Usuario' }}
                        </p>
                        <p class="text-xs text-gray-500">
                            {{ currentUser?.email || 'usuario@empresa.com' }}
                        </p>
                    </div>
                    <button (click)="goToProfile()"
                        class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors">
                        <fa-icon [icon]="getIcon('user')" class="text-gray-500" />
                        Mi Perfil
                    </button>

                    <button
                        class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors">
                        <fa-icon [icon]="getIcon('gear')" class="text-gray-500" />
                        Configuración
                    </button>

                    <button
                        class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-3 transition-colors">
                        <fa-icon [icon]="getIcon('question-circle')" class="text-gray-500" />
                        Ayuda
                    </button>

                    <div class="border-t border-gray-200 mt-2 pt-2">
                        <button (click)="logout()"
                            class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 flex items-center gap-3 transition-colors">
                            <fa-icon [icon]="getIcon('sign-out-alt')" class="text-red-500" />
                            Cerrar Sesión
                        </button>
                    </div>
                </div>
            }
        </div>
    </div>
</header>
